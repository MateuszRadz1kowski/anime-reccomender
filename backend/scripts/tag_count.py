import math
from collections import defaultdict
import json

tags_counted = defaultdict(int)

def count_tags(anime_data_packed):

    for anime in anime_data_packed:

        tags = json.loads( anime[7])
        for tag in tags:
            tag_id = tag.get("id")
            if tag_id is not None:
                tags_counted[tag_id] += 1

def export_tag_count():
    return {276: 329, 252: 631, 34: 902, 85: 1716, 93: 432, 1228: 1262, 66: 1451, 82: 4759, 99: 895, 94: 915, 43: 1165, 365: 404, 95: 127, 217: 348, 624: 21, 105: 1665, 1382: 302, 310: 139, 870: 81, 779: 1378, 56: 2040, 102: 961, 1046: 354, 143: 299, 1752: 364, 153: 512, 240: 462, 250: 579, 90: 1313, 88: 1290, 76: 805, 1052: 254, 15: 1067, 74: 295, 1310: 471, 259: 337, 208: 445, 25: 1155, 683: 76, 639: 454, 1689: 126, 324: 798, 1616: 167, 433: 1540, 142: 527, 648: 503, 694: 433, 104: 598, 226: 344, 40: 470, 391: 651, 109: 1617, 253: 577, 321: 1210, 595: 1229, 1539: 309, 163: 247, 548: 233, 194: 90, 322: 268, 156: 190, 622: 37, 233: 355, 1719: 104, 536: 269, 29: 2000, 30: 574, 772: 394, 46: 3046, 1304: 488, 83: 740, 281: 736, 494: 460, 1489: 79, 149: 230, 251: 206, 172: 317, 171: 435, 326: 322, 1427: 70, 774: 49, 112: 236, 342: 235, 107: 100, 178: 217, 106: 163, 103: 549, 121: 29, 308: 318, 1492: 31, 1165: 124, 39: 960, 80: 153, 801: 193, 50: 1112, 191: 890, 1121: 117, 404: 194, 1045: 2072, 586: 173, 1526: 33, 201: 164, 1277: 409, 305: 273, 456: 470, 111: 838, 247: 171, 466: 222, 1090: 119, 175: 814, 659: 105, 291: 332, 157: 1004, 1453: 137, 490: 162, 499: 92, 1433: 125, 517: 471, 100: 1654, 224: 420, 489: 231, 1455: 178, 558: 95, 255: 257, 96: 619, 77: 282, 101: 157, 1681: 30, 1866: 3, 1342: 117, 265: 249, 152: 193, 122: 280, 1068: 170, 1578: 68, 483: 1140, 1291: 49, 198: 869, 1219: 248, 1243: 61, 1091: 229, 931: 428, 335: 439, 164: 753, 186: 522, 1589: 53, 446: 623, 1564: 96, 615: 104, 139: 854, 91: 89, 244: 945, 1745: 30, 86: 2345, 23: 1188, 155: 818, 212: 81, 1102: 104, 154: 136, 146: 332, 468: 134, 311: 185, 516: 119, 215: 142, 98: 4412, 161: 117, 646: 23, 294: 320, 1537: 230, 285: 242, 165: 370, 189: 162, 193: 1238, 1456: 148, 84: 664, 220: 403, 395: 264, 170: 56, 87: 584, 1673: 48, 1598: 50, 488: 240, 1596: 48, 179: 253, 1753: 125, 249: 435, 598: 265, 812: 112, 254: 521, 144: 556, 113: 297, 654: 205, 267: 158, 97: 286, 1670: 65, 199: 129, 138: 490, 1379: 43, 116: 65, 1063: 353, 282: 124, 115: 870, 1403: 122, 243: 352, 614: 88, 604: 126, 780: 287, 1657: 34, 1645: 90, 262: 192, 1105: 27, 1419: 58, 140: 388, 1292: 116, 394: 81, 145: 730, 110: 249, 618: 7, 723: 58, 999: 52, 147: 158, 658: 36, 665: 69, 1667: 19, 397: 99, 159: 458, 1146: 113, 63: 824, 380: 112, 118: 192, 909: 91, 355: 184, 874: 62, 632: 21, 1327: 166, 160: 396, 636: 207, 513: 260, 75: 363, 1523: 31, 356: 168, 228: 39, 1632: 11, 613: 26, 221: 12, 652: 17, 303: 105, 1525: 39, 593: 21, 1459: 44, 327: 62, 108: 263, 1648: 24, 476: 58, 183: 14, 857: 71, 248: 82, 264: 132, 1674: 82, 128: 371, 173: 225, 176: 47, 334: 66, 480: 63, 1771: 90, 124: 194, 117: 70, 1367: 52, 131: 402, 227: 239, 901: 41, 328: 184, 81: 403, 137: 779, 1760: 49, 1647: 83, 1907: 15, 410: 103, 195: 116, 1140: 33, 400: 184, 623: 94, 1361: 32, 162: 159, 1742: 134, 190: 56, 364: 61, 1666: 37, 1422: 23, 1615: 24, 127: 321, 386: 65, 10: 240, 710: 288, 92: 943, 653: 142, 174: 90, 27: 168, 1571: 61, 53: 608, 1788: 31, 123: 163, 631: 79, 246: 380, 148: 129, 204: 21, 1490: 153, 192: 111, 169: 79, 28: 1697, 443: 6, 89: 1482, 1601: 183, 704: 121, 231: 72, 678: 20, 214: 17, 1724: 25, 188: 104, 809: 23, 949: 17, 534: 87, 811: 19, 309: 111, 519: 34, 1607: 22, 150: 121, 158: 204, 1501: 35, 792: 26, 359: 121, 151: 35, 1612: 24, 242: 109, 1779: 26, 209: 323, 206: 2, 235: 22, 1835: 6, 132: 264, 134: 897, 125: 804, 135: 478, 181: 62, 129: 383, 185: 442, 279: 195, 1235: 117, 830: 259, 317: 423, 136: 152, 130: 375, 180: 127, 126: 386, 651: 7, 1132: 11, 1709: 21, 1047: 232, 120: 21, 182: 16, 167: 17, 325: 86, 187: 196, 481: 21, 239: 43, 650: 80, 471: 129, 1690: 254, 1672: 3, 532: 24, 1080: 17, 630: 12, 1574: 11, 314: 25, 341: 493, 1675: 19, 133: 296, 1848: 3, 387: 42, 1396: 6, 437: 11, 1867: 5, 482: 20, 1450: 2, 1544: 11, 323: 300, 1624: 16, 1732: 10, 505: 365, 1039: 94, 1038: 79, 318: 71, 1511: 72, 1515: 8, 845: 63, 533: 1, 315: 78, 1807: 11, 649: 22, 316: 46, 360: 59, 1234: 61, 1653: 6, 1573: 4, 629: 14, 1273: 36, 1337: 8, 1446: 12, 1790: 28, 280: 19, 1659: 3, 1591: 1}

def get_tag_popularity_weight(tag):
    tag_count = export_tag_count()
    #log((tag with max count + some number so tags with very few instances arent lost) / tag count + some number so tags with very few instances arent lost)) ** number to normalise less popular and more popular tags
    #tag_weight = (math.log((4759 + 100) / tag_count[tag["id"]] + 100)) **1.5
    tag_weight = math.log((4759+100)/(100+tag_count[tag["id"]]))
    return tag_weight


#total pages 441
#last page 39 records